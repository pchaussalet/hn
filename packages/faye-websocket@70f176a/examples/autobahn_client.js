var WebSocket=require("../lib/faye/websocket"),deflate=require("permessage-deflate"),pace=require("pace"),host="ws://localhost:9001",agent=encodeURIComponent("node-"+process.version),cases=0,options={extensions:[deflate]},socket=new WebSocket.Client(host+"/getCaseCount"),url,progress;socket.onmessage=function(e){console.log("Total cases to run: "+e.data),cases=parseInt(e.data),progress=pace(cases)};var runCase=function(e){return e>cases?(url=host+"/updateReports?agent="+agent,socket=new WebSocket.Client(url),socket.onclose=process.exit,void 0):(url=host+"/runCase?case="+e+"&agent="+agent,socket=new WebSocket.Client(url,null,options),socket.pipe(socket),socket.on("close",function(){progress.op(),runCase(e+1)}),void 0)};socket.onclose=function(){runCase(1)};