montageDefine("70f176a","examples/server",{dependencies:["../lib/faye/websocket","permessage-deflate","fs","http","https"],factory:function(e){var t=e("../lib/faye/websocket"),n=e("permessage-deflate"),i=e("fs"),r=e("http"),a=e("https"),s=process.argv[2]||7e3,o="tls"===process.argv[3],l={extensions:[n],ping:5},c=function(e,n,i){var r=new t(e,n,i,["irc","xmpp"],l);console.log("[open]",r.url,r.version,r.protocol,e.headers),r.pipe(r),r.onclose=function(e){console.log("[close]",e.code,e.reason),r=null}},u=function(e,n){if(!t.EventSource.isEventSource(e))return h(e,n);var r=new t.EventSource(e,n),a=parseInt(r.lastEventId,10)||0;console.log("[open]",r.url,r.lastEventId);var s=setInterval(function(){a+=1,r.send("Time: "+a),setTimeout(function(){r&&r.send("Update!!",{event:"update",id:a})},1e3)},2e3);i.createReadStream(__dirname+"/haproxy.conf").pipe(r,{end:!1}),r.onclose=function(){clearInterval(s),console.log("[close]",r.url),r=null}},h=function(e,t){var n=e.url;i.readFile(__dirname+n,function(e,n){var i=e?404:200;t.writeHead(i,{"Content-Type":"text/html"}),t.write(n||"Not found"),t.end()})},d=o?a.createServer({key:i.readFileSync(__dirname+"/../spec/server.key"),cert:i.readFileSync(__dirname+"/../spec/server.crt")}):r.createServer();d.on("request",u),d.on("upgrade",c),d.listen(s)}});