montageDefine("70f176a","lib/faye/websocket/client",{dependencies:["util","net","tls","crypto","url","websocket-driver","./api","./api/event"],factory:function(e,t,n){var i=e("util"),r=e("net"),a=e("tls"),s=(e("crypto"),e("url")),o=e("websocket-driver"),l=e("./api");e("./api/event");var c={"http:":80,"https:":443,"ws:":80,"wss:":443},u=["https:","wss:"],h=function(e,t,n){n=n||{},this.url=e,this._driver=o.client(this.url,{maxLength:n.maxLength,protocols:t}),["open","error"].forEach(function(e){this._driver.on(e,function(){v.headers=v._driver.headers,v.statusCode=v._driver.statusCode})},this);var i=n.proxy||{},h=s.parse(i.origin||this.url),d=h.port||c[h.protocol],p=u.indexOf(h.protocol)>=0,f=function(){v._onConnect()},g=n.tls||{},m=i.origin?i.tls||{}:g,v=this;g.ca=g.ca||n.ca,this._stream=p?a.connect(d,h.hostname,m,f):r.connect(d,h.hostname,f),i.origin&&this._configureProxy(i,g),l.call(this,n)};i.inherits(h,l),h.prototype._onConnect=function(){var e=this._proxy||this._driver;e.start()},h.prototype._configureProxy=function(e,t){var n,i=s.parse(this.url),r=u.indexOf(i.protocol)>=0,o=this;if(this._proxy=this._driver.proxy(e.origin),e.headers)for(n in e.headers)this._proxy.setHeader(n,e.headers[n]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(r){var e={socket:o._stream,servername:i.hostname};for(n in t)e[n]=t[n];o._stream=a.connect(e),o._configureStream()}o._driver.io.pipe(o._stream),o._stream.pipe(o._driver.io),o._driver.start()}),this._proxy.on("error",function(e){o._driver.emit("error",e)})},n.exports=h}});