montageDefine("199c172","bind",{dependencies:["./parse","./algebra","./stringify","./compile-observer","./compile-binder","./compile-assigner","./observers","./binders","./scope"],factory:function(e,t,n){function i(e,t,n){n.target=e,n.targetPath=t;var i=n.source=n.source||e,c=n["<-"]||n["<->"]||"",u=n.twoWay="<->"in n;n.sourcePath=c,n.value;var h=n.parameters=n.parameters||i,d=n.document,p=n.components,g=n.trace,m=n.sourceScope=new f(i);m.parameters=h,m.document=d,m.components=p;var v=n.targetScope=new f(e);if(v.parameters=h,v.document=d,v.components=p,n.converter){var y=n.converter;y.convert&&(n.convert=y.convert.bind(y)),y.revert&&(n.revert=y.revert.bind(y))}else if(n.reverter){var b=n.reverter;b.convert&&(n.revert=b.convert.bind(b)),b.revert&&(n.convert=b.revert.bind(b))}var _=n.convert,w=n.revert,C=n.sourceSyntax=o(c),L=n.targetSyntax=o(t),x=s(L,C);if(L=x[0],C=x[1],u&&"rangeContent"===L.type)return a(v,L.args[0],m,C,_,w,n,g?{sourcePath:l(C),targetPath:l(L.args[0])}:null);g&&console.log("DEFINE BINDING",t,"<-",c,e);var M=r(v,L,m,C,_,n,g),x=s(C,L);C=x[0],L=x[1];var E=Function.noop;return u&&(g&&console.log("DEFINE BINDING",t,"->",c,i),E=r(m,C,v,L,w,n,g)),function(){M(),E()}}function r(e,t,n,i,r,a,o){var s=c(i);r&&(s=d.makeConverterObserver(s,r,n));var h=u(t);return h(s,n,e,a,o?{sourcePath:l(i),targetPath:l(t)}:null)}function a(e,t,n,i,r,a,o,s){function l(e,t,n){m||(m=!0,s&&console.log("RANGE CONTENT PROPAGATED",s.targetPath,"<-",s.sourcePath,"PLUS",e,"MINUS",t,"AT",n),f.swap(n,t.length,e),m=!1)}function u(e,t,n){m||(m=!0,s&&console.log("RANGE CONTENT PROPAGATED",s.targetPath,"->",s.sourcePath,"PLUS",e,"MINUS",t,"AT",n),g.swap(n,t.length,e),m=!1)}function d(){if(g!==f){s&&console.log("RANGE CONTENT BOUND",s.targetPath,"<->",s.sourcePath),m=!0;var t=p(g,l,n),i=p(f,u,e);return m=!1,function(){s&&console.log("RANGE CONTENT UNBOUND",s.targetPath,"<->",s.sourcePath),t(),i()}}}var f,g,m,v=c(i),y=c(t),b=h(i),_=h(t),w=Function.noop;m=!0;var C=y(function(e){w(),w=Function.noop,s&&console.log("RANGE CONTENT TARGET",s.targetPath,"SET TO",e),e&&e.addRangeChangeListener&&(f=e,g&&f?(s&&console.log("RANGE CONTENT TARGET REPLACES SOURCE",s.targetPath,"->",s.sourcePath,"WITH",f),m=!0,g.swap(0,g.length,f),m=!1,w=d()):g||m||(s&&console.log("RANGE CONTENT TARGET INITIALIZED TO COPY OF SOURCE",s.targetPath,"<-",tarce.sourcePath,"WITH",g),b(f.clone(),n)))},e);m=!1;var L=v(function(t){w(),w=Function.noop,s&&console.log("RANGE CONTENT SOURCE",s.sourcePath,"SET TO",t),t&&t.addRangeChangeListener&&(g=t,f&&g?(s&&console.log("RANGE CONTENT SOURCE REPLACES TARGET",s.targetPath,"<-",s.sourcePath,"WITH",g),m=!0,f.swap(0,f.length,g),m=!1,w=d()):f||_(g.clone(),e))},n);return f||g||b([],n),function(){w(),C(),L()}}var o=e("./parse"),s=e("./algebra"),l=e("./stringify"),c=e("./compile-observer"),u=e("./compile-binder"),h=e("./compile-assigner"),d=e("./observers"),p=d.observeRangeChange;e("./binders");var f=e("./scope");n.exports=i}});