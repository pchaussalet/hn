montageDefine("89c58a0","lib/websocket/driver/base",{dependencies:["events","util","../streams","./headers"],factory:function(e,t,n){"use strict";var r=e("events").EventEmitter,i=e("util"),a=e("../streams"),o=e("./headers"),s=function(e,t,n){r.call(this),s.validateOptions(n||{},["maxLength","masking","requireMasking","protocols"]),this._request=e,this._options=n||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new o,this.__queue=[],this.readyState=0,this.url=t,this.io=new a.IO(this),this.messages=new a.Messages(this),this._bindEventListeners()};i.inherits(s,r),s.validateOptions=function(e,t){for(var n in e)if(0>t.indexOf(n))throw Error("Unrecognized option: "+n)};var l={MAX_LENGTH:67108863,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var e=this;this.messages.on("error",function(){}),this.on("message",function(t){var n=e.messages;n.readable&&n.emit("data",t.data)}),this.on("error",function(t){var n=e.messages;n.readable&&n.emit("error",t)}),this.on("close",function(){var t=e.messages;t.readable&&(t.readable=t.writable=!1,t.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(){return!1},setHeader:function(e,t){return this.readyState>0?!1:(this._headers.set(e,t),!0)},start:function(){return 0!==this.readyState?!1:(this._write(this._handshakeResponse()),-1!==this._stage&&this._open(),!0)},text:function(e){return this.frame(e)},binary:function(){return!1},ping:function(){return!1},close:function(){return 1!==this.readyState?!1:(this.readyState=3,this.emit("close",new s.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(e){this.frame.apply(this,e)},this),this.__queue=[],this.emit("open",new s.OpenEvent)},_queue:function(e){return this.__queue.push(e),!0},_write:function(e){var t=this.io;t.readable&&t.emit("data",e)}};for(var c in l)s.prototype[c]=l[c];s.ConnectEvent=function(){},s.OpenEvent=function(){},s.CloseEvent=function(e,t){this.code=e,this.reason=t},s.MessageEvent=function(e){this.data=e},n.exports=s}});