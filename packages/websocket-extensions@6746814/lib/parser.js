"use strict";var TOKEN=/([!#\$%&'\*\+\-\.\^_`\|~0-9a-z]+)/,NOTOKEN=/([^!#\$%&'\*\+\-\.\^_`\|~0-9a-z])/g,QUOTED=/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"])*)"/,PARAM=RegExp(TOKEN.source+"(?:=(?:"+TOKEN.source+"|"+QUOTED.source+"))?"),EXT=RegExp(TOKEN.source+"(?: *; *"+PARAM.source+")*","g"),EXT_LIST=RegExp("^"+EXT.source+"(?: *, *"+EXT.source+")*$"),NUMBER=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,Parser={parseHeader:function(e){var t=new Offers;if(""===e||void 0===e)return t;if(!EXT_LIST.test(e))throw new SyntaxError("Invalid Sec-WebSocket-Extensions header: "+e);var n=e.match(EXT);return n.forEach(function(e){var n=e.match(RegExp(PARAM.source,"g")),i=n.shift(),r={};n.forEach(function(e){var t,n=e.match(PARAM),i=n[1];t=void 0!==n[2]?n[2]:void 0!==n[3]?n[3].replace(/\\/g,""):!0,NUMBER.test(t)&&(t=parseFloat(t)),r.hasOwnProperty(i)?(r[i]=[].concat(r[i]),r[i].push(t)):r[i]=t},this),t.push(i,r)},this),t},serializeParams:function(e,t){var n=[],i=function(e,t){t instanceof Array?t.forEach(function(t){i(e,t)}):t===!0?n.push(e):"number"==typeof t?n.push(e+"="+t):NOTOKEN.test(t)?n.push(e+'="'+t.replace(/"/g,'\\"')+'"'):n.push(e+"="+t)};for(var r in t)i(r,t[r]);return[e].concat(n).join("; ")}},Offers=function(){this._byName={},this._inOrder=[]};Offers.prototype.push=function(e,t){this._byName[e]=this._byName[e]||[],this._byName[e].push(t),this._inOrder.push({name:e,params:t})},Offers.prototype.eachOffer=function(e,t){for(var n=this._inOrder,i=0,r=n.length;r>i;i++)e.call(t,n[i].name,n[i].params)},Offers.prototype.byName=function(e){return this._byName[e]||[]},Offers.prototype.toArray=function(){return this._inOrder.slice()},module.exports=Parser;