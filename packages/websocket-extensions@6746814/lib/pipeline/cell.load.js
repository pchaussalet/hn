montageDefine("6746814","lib/pipeline/cell",{dependencies:["./functor","./pledge"],factory:function(e,t,n){"use strict";var i=e("./functor"),r=e("./pledge"),a=function(e){this._ext=e[0],this._session=e[1],this._functors={incoming:new i(this._session,"processIncomingMessage"),outgoing:new i(this._session,"processOutgoingMessage")}};a.prototype.pending=function(e){this._functors[e].pending+=1},a.prototype.incoming=function(e,t,n,i){this._exec("incoming",e,t,n,i)},a.prototype.outgoing=function(e,t,n,i){this._exec("outgoing",e,t,n,i)},a.prototype.close=function(){return this._closed=this._closed||new r,this._doClose(),this._closed},a.prototype._exec=function(e,t,n,i,r){this._functors[e].call(t,n,function(e,t){e&&(e.message=this._ext.name+": "+e.message),i.call(r,e,t),this._doClose()},this)},a.prototype._doClose=function(){var e=this._functors.incoming,t=this._functors.outgoing;this._closed&&0===e.pending+t.pending&&(this._session&&this._session.close(),this._session=null,this._closed.done())},n.exports=a}});