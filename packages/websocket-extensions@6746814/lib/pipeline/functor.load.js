montageDefine("6746814","lib/pipeline/functor",{dependencies:["./ring_buffer"],factory:function(e,t,n){"use strict";var i=e("./ring_buffer"),r=function(e,t){this._session=e,this._method=t,this._queue=new i(r.QUEUE_SIZE),this._stopped=!1,this.pending=0};r.QUEUE_SIZE=8,r.prototype.call=function(e,t,n,i){if(!this._stopped){var r={error:e,message:t,callback:n,context:i,done:!1},a=!1,o=this;return this._queue.push(r),r.error?(r.done=!0,this._stop(),this._flushQueue()):(this._session[this._method](t,function(e,t){a^(a=!0)&&(e?(o._stop(),r.error=e,r.message=null):r.message=t,r.done=!0,o._flushQueue())}),void 0)}},r.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0},r.prototype._flushQueue=function(){for(var e,t=this._queue;t.length>0&&t.peek().done;)this.pending-=1,e=t.shift(),e.callback.call(e.context,e.error,e.message)},n.exports=r}});