var Component=require("montage/ui/component").Component,_makeParamsIntoHash=function(e){return(e||"").split(/\?|&/).slice(1).map(function(e){return e.split("=",2)}).reduce(function(e,t){return e[t[0]]?(e[t[0]].push||(e[t[0]]=[e[t[0]]]),e[t[0]].push(t[1])):e[t[0]]=t[1],e},{})};exports.Main=Component.specialize({constructor:{value:function(){this.super()}},navigationIndex:{get:function(){return this._navigationIndex},set:function(e){this._navigationIndex!==e&&(this._navigationIndex=e,this.needsDraw=!0)}},_navigationIndex:{value:0},navigation:{value:[{kind:"stories"}]},_displayedNavigationIndex:{value:0},navigationContentLoadedForIndex:{value:function(e,t){e&&(this.navigationIndex===t&&(this._displayedNavigationIndex=this.navigationIndex,this.needsDraw=!0),this.navigation[t].kind=e.type||e.created&&"user",this.navigation[t].item_id=e.id)}},navigateToURL:{value:function(e,t){var n=new URL(e);if("/item"===n.pathname||"/user"===n.pathname){var i=_makeParamsIntoHash(n.search);if(i.id){this.navigationIndex=this._displayedNavigationIndex+1;var o=!this.navigation[this.navigationIndex];if(o)for(var r=this.navigationIndex;r+1>this.navigation.length;)this.navigation.push({kind:"loading"});else this.navigation[this.navigationIndex].kind="loading",this.navigation[this.navigationIndex].item_id=null;t||history.pushState({item_id:i.id,nav_index:this.navigationIndex},"","#!"+n.pathname+"?id="+i.id);var a=this,s=this.navigationIndex,l=new Firebase("https://hacker-news.firebaseio.com/v0"+n.pathname+"/"+i.id),c=l.on("value",function(e){a.navigationContentLoadedForIndex(e.val(),s),l.off("value",c)})}}}},handleClick:{value:function(e){var t=e.target;if(t){for(;t&&"A"!==t.tagName&&t.parentNode!==t;)t=t.parentNode;if(t&&"A"===t.tagName){var n=new URL(t.getAttribute("href"));return(n.host===location.host||"news.ycombinator.com"===n.hostname)&&(e.preventDefault(),e.stopPropagation(),this.navigateToURL(t.getAttribute("href"))),!1}return!0}}},handlePopstate:{value:function(e){var t,n=(t=e,t=t&&t.state,(t=t&&t.nav_index)||this._displayedNavigationIndex-1);n=Math.max(0,n),this.navigationIndex=this._displayedNavigationIndex=n}},enterDocument:{value:function(e){if(e&&(window.addEventListener("popstate",this,!1),this.element.addEventListener("click",this,!1),location.hash)){var t=location.hash.split(/\#\!/)[1];t&&this.navigateToURL("https://news.ycombinator.com"+t,!0)}}},draw:{value:function(){this.super();var e=this.element.children[0].children;if(e.length===this.navigation.length){var t;for(t=0;e.length>t;t++){var n=e[t],i=t-this._displayedNavigationIndex;i=0>i?-1/(1<<-i):1.2*i,n.style.transform="translate3d("+100*i+"%, 0, 0)",n.style.WebkitTransform="translate3d("+100*i+"%, 0, 0)"}}else this.needsDraw=!0}}});